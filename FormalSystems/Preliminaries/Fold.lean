import Mathlib.Data.List.Basic
import Mathlib.Data.Finset.Fold

variable [DecidableEq Î²]

/--Theorem: Given a list of finite sets`l`, an element`e`is in the union of
  all the finite sets within`l` if and only if`e`is within one of`l`'s elements (âˆƒ).-/
theorem List.mem_fold_union_iff { l: List (Finset Î²) }:
  e âˆˆ List.foldr (Â· âˆª Â·) âˆ… l â†” âˆƒs âˆˆ l, e âˆˆ s := by
  constructor
  . intro h
    induction l with
    | nil => contradiction
    | cons _ _ ih =>
      simp at h
      cases h <;> simp
      . apply Or.inl
        assumption
      . apply Or.inr
        apply ih
        assumption

  . intro âŸ¨s, h, _âŸ©
    induction l with
    | nil => contradiction
    | cons _ _ ih =>
      simp at h
      cases h <;> simp
      case inl h =>
        apply Or.inl; rw [<- h]
        assumption
      case inr _ =>
        apply Or.inr
        apply ih
        assumption

/--Theorem: An element`e`is in the set `ğ”½`,

  where `ğ”½`is the union of the sets
  returned by the function`f`applied to each element of the finite set`s`,

  if and only if that`e`can be generated by applying`f`to one of the elements
  in`s`.-/
theorem Finset.mem_fold_union_iff { f: Î± â†’ Finset Î² }:
  e âˆˆ Finset.fold Union.union âˆ… f s â†” âˆƒ x âˆˆ s, e âˆˆ f x := by
  constructor
  . have âŸ¨s, _âŸ© := s
    revert s
    apply Quot.ind
    intro l _ h
    dsimp [Finset.fold] at h
    have âŸ¨_, h, _âŸ© := List.mem_fold_union_iff.mp h
    simp at h
    have âŸ¨x, _, hâŸ© := h
    exists x; simp [h]
    constructor; repeat { assumption }

  . intro âŸ¨x, hâ‚, hâ‚‚âŸ©
    have âŸ¨s, _âŸ© := s
    revert s
    apply Quot.ind
    intro l _ h
    simp [Finset.fold, Multiset.fold]
    apply List.mem_fold_union_iff.mpr
    exists f x
    simp; constructor
    exists x
    assumption

/--Theorem:`Finset.fold`with some function`f`respects the subset relation.-/
theorem Finset.fold_union_subs [DecidableEq Î²] { f: Î± â†’ Finset Î² } { qa qb: Finset Î± } (h: qa âŠ† qb):
  Finset.fold (Î²:=Finset Î²) (Â· âˆª Â·) âˆ… f qa âŠ† Finset.fold (Â· âˆª Â·) âˆ… f qb := by
  apply Finset.subset_iff.mpr
  intro _ h
  apply Finset.mem_fold_union_iff.mpr
  have âŸ¨x, _, _âŸ© := Finset.mem_fold_union_iff.mp h
  exists x; constructor
  apply Finset.mem_of_subset
  repeat { assumption }
